"use strict";(self["webpackChunkweweb_front"]=self["webpackChunkweweb_front"]||[]).push([[113],{113:(e,a,i)=>{i.r(a),i.d(a,{default:()=>g});var t=i(6252);const l={class:"flex items-center"},n={class:"w-100 -full"},o={class:"flex items-center"},r={class:"w-100 -full"},d=["disabled"],p={class:"flex items-center justify-end w-full body-3 text-red-500"},s=["onClick"],u={class:"flex items-center justify-end w-full body-3 text-red-500"},m=["onClick"];function c(e,a,i,c,h,b){const y=(0,t.up)("wwEditorInputRow"),g=(0,t.up)("wwEditorIcon"),w=(0,t.up)("wwEditorFormRow"),f=(0,t.up)("wwLoader");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",l,[(0,t._)("div",n,[(0,t.Wm)(y,{label:"Api group",type:"select",placeholder:"Select an api group",required:"","model-value":b.api.apiGroupUrl,options:b.apiGroupsOptions,"onUpdate:modelValue":a[0]||(a[0]=e=>b.setProp("apiGroupUrl",e))},null,8,["model-value","options"])]),(0,t._)("button",{type:"button",class:"ww-editor-button -small -primary ml-2 mt-3",onClick:a[1]||(a[1]=(...e)=>b.refreshManager&&b.refreshManager(...e))}," refresh ")]),(0,t._)("div",o,[(0,t._)("div",r,[(0,t.Wm)(y,{label:"Endpoint",type:"select",full:"",placeholder:"Select an endpoint",required:"","model-value":b.endpointValue,options:b.endpointsOptions,"onUpdate:modelValue":b.setEndpoint},null,8,["model-value","options","onUpdate:modelValue"])]),(0,t._)("button",{type:"button",class:"ww-editor-button -small -primary ml-2 mt-3",onClick:a[2]||(a[2]=(...e)=>b.refreshSpec&&b.refreshSpec(...e)),disabled:!b.api.apiGroupUrl}," refresh ",8,d)]),(0,t.Wm)(y,{label:"Headers",type:"array","model-value":b.api.headers,bindable:"dynamic"===i.collection.mode,"onUpdate:modelValue":a[3]||(a[3]=e=>b.setProp("headers",e)),onAddItem:a[4]||(a[4]=e=>b.setProp("headers",[...b.api.headers||[],{}]))},{default:(0,t.w5)((({item:e,setItem:a})=>[(0,t.Wm)(y,{type:"query","model-value":e.key,label:"Key",placeholder:"Enter a value",small:"",bindable:"dynamic"===i.collection.mode,"onUpdate:modelValue":i=>a({...e,key:i})},null,8,["model-value","bindable","onUpdate:modelValue"]),(0,t.Wm)(y,{type:"query","model-value":e.value,label:"Value",placeholder:"Enter a value",small:"",bindable:"dynamic"===i.collection.mode,"onUpdate:modelValue":i=>a({...e,value:i})},null,8,["model-value","bindable","onUpdate:modelValue"])])),_:1},8,["model-value","bindable"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.legacyParameters,((e,a)=>((0,t.wg)(),(0,t.j4)(w,{key:a,label:e},{"append-label":(0,t.w5)((()=>[(0,t._)("div",p,[(0,t.Uk)(" This parameter doesn't exist anymore "),(0,t._)("button",{type:"button",class:"ww-editor-button -icon -small -tertiary -red ml-1",onClick:a=>b.removeParam([e])},[(0,t.Wm)(g,{small:"",name:"trash"})],8,s)])])),default:(0,t.w5)((()=>[(0,t.Wm)(y,{type:"query",bindable:"","model-value":b.api.parameters[e]},null,8,["model-value"])])),_:2},1032,["label"])))),128)),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.endpointParameters,((e,a)=>((0,t.wg)(),(0,t.j4)(y,{key:a,label:e.name,type:"query",placeholder:"Enter a value",bindable:"dynamic"===i.collection.mode,"binding-validation":e.bindingValidation,required:e.required,"model-value":b.api.parameters[e.name],"onUpdate:modelValue":a=>b.setProp("parameters",{...b.api.parameters,[e.name]:a})},null,8,["label","bindable","binding-validation","required","model-value","onUpdate:modelValue"])))),128)),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.legacyBody,((e,a)=>((0,t.wg)(),(0,t.j4)(w,{key:a,label:e},{"append-label":(0,t.w5)((()=>[(0,t._)("div",u,[(0,t.Uk)(" This field doesn't exist anymore "),(0,t._)("button",{type:"button",class:"ww-editor-button -icon -small -tertiary -red ml-1",onClick:a=>b.removeBody([e])},[(0,t.Wm)(g,{small:"",name:"trash"})],8,m)])])),default:(0,t.w5)((()=>[(0,t.Wm)(y,{type:"query",bindable:"","model-value":b.api.body[e],"onUpdate:modelValue":a=>b.setProp("body",{...b.api.body,[e]:a})},null,8,["model-value","onUpdate:modelValue"])])),_:2},1032,["label"])))),128)),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.endpointBody,((e,a)=>((0,t.wg)(),(0,t.j4)(y,{key:a,label:e.name,type:e.type||"string",placeholder:"Enter a value",bindable:"dynamic"===i.collection.mode,"binding-validation":e.bindingValidation,required:e.required,"model-value":b.api.body[e.name],"onUpdate:modelValue":a=>b.setProp("body",{...b.api.body,[e.name]:a})},null,8,["label","type","bindable","binding-validation","required","model-value","onUpdate:modelValue"])))),128)),(0,t.Wm)(f,{loading:h.isLoading},null,8,["loading"])],64)}var h={props:{plugin:{type:Object,required:!0},collection:{type:Object,required:!0},config:{type:Object,required:!0}},emits:["update:config"],data(){return{isLoading:!1,apiGroups:[],spec:null}},mounted(){this.plugin.xanoManager.hasFailed()?wwLib.wwNotification.open({text:"Failed to init Xano, please ensure your API key has the permission required.",color:"red"}):(this.isLoading=!0,this.plugin.xanoManager.onReady((async()=>{this.apiGroups=this.plugin.xanoManager.getApiGroups(),await this.refreshSpec(),this.isLoading=!1})))},computed:{apiGroupUrl(){return this.plugin.xanoManager.fixUrl(this.config.apiGroupUrl)},api(){return{endpoint:null,headers:[],parameters:{},body:{},...this.config,apiGroupUrl:this.apiGroupUrl}},endpointValue(){return this.api.endpoint?`${this.api.endpoint.method}-${this.api.endpoint.path}`:null},apiGroupsOptions(){return this.apiGroups.map((e=>({label:e.name,value:e.api})))},endpointsOptions(){return this.plugin.xanoManager.parseSpecEndpoints(this.spec)},endpointParameters(){return this.plugin.xanoManager.parseSpecEndpointParameters(this.spec,this.api.endpoint)},endpointBody(){return this.plugin.xanoManager.parseSpecEndpointBody(this.spec,this.api.endpoint)},legacyParameters(){if(this.isLoading)return[];const e=this.endpointParameters.map((e=>e.name));return Object.keys(this.api.parameters).filter((a=>!e.includes(a)))},legacyBody(){if(this.isLoading)return[];const e=this.endpointBody.map((e=>e.name));return Object.keys(this.api.body).filter((a=>!e.includes(a)))}},watch:{apiGroupUrl(){this.refreshSpec()}},methods:{setProp(e,a){this.$emit("update:config",{...this.api,[e]:a})},setEndpoint(e){const[a,i]=e.split(/-(.+)/);this.setProp("endpoint",{method:a,path:i})},removeParam(e){const a={...this.api.parameters};for(const i of e)delete a[i];this.setProp("parameters",a)},removeBody(e){const a={...this.api.body};for(const i of e)delete a[i];this.setProp("body",a)},async refreshManager(){try{this.isLoading=!0,await this.plugin.xanoManager.init(),this.apiGroups=this.plugin.xanoManager.getApiGroups()}catch(e){wwLib.wwLog.error(e)}finally{this.isLoading=!1}},async refreshSpec(){if(this.apiGroupUrl)try{this.isLoading=!0,this.spec=await this.plugin.xanoManager.fetchApiGroupSpec(this.apiGroupUrl)}catch(e){wwLib.wwLog.error(e)}finally{this.isLoading=!1}}}},b=i(3744);const y=(0,b.Z)(h,[["render",c]]);var g=y}}]);