"use strict";(self["webpackChunkweweb_front"]=self["webpackChunkweweb_front"]||[]).push([[85],{1085:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var i=a(6252),s=a(9963),n=a(3577);const l={class:"flex flex-col"},o=(0,i._)("a",{class:"ml-2 ww-editor-link",href:"https://docs.xano.com/developer-api",target:"_blank"}," Find it here ",-1),p={class:"flex items-center"},d=(0,i._)("a",{class:"ml-2 ww-editor-link",href:"https://docs.xano.com/metadata-api",target:"_blank"}," Find it here ",-1),r={class:"flex items-center"},c={key:1,class:"label-sm flex items-center text-yellow-500 mb-3"},u={key:2,class:"label-sm flex items-center text-red-500 mb-3"},m=(0,i._)("a",{class:"ml-2 ww-editor-link",href:"https://docs.xano.com/building-features/authentication-sign-up-and-log-in/authentication/oauth-social-sign-in",target:"_blank"}," How to configure OAuth providers ",-1),g={class:"flex items-center"},h={class:"truncate"};function b(e,t,a,b,y,w){const D=(0,i.up)("wwEditorInputText"),v=(0,i.up)("wwEditorIcon"),f=(0,i.up)("wwEditorFormRow"),k=(0,i.up)("wwEditorInputRow"),E=(0,i.up)("wwLoader");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",l,[y.deprecated?((0,i.wg)(),(0,i.j4)(f,{key:0,required:"",label:"Developer API key (Deprecated)"},{"append-label":(0,i.w5)((()=>[o])),default:(0,i.w5)((()=>[(0,i._)("div",p,[(0,i.Wm)(D,{type:y.isKeyVisible?"text":"password",name:"api-key",placeholder:"ey**************","model-value":a.settings.privateData.apiKey,"onUpdate:modelValue":w.changeApiKey,class:"w-full mr-2",disabled:a.settings.privateData.metaApiKey},null,8,["type","model-value","onUpdate:modelValue","disabled"]),(0,i._)("button",{class:"ww-editor-button -icon -secondary -dark",onClick:t[0]||(t[0]=(0,s.iM)((e=>y.isKeyVisible=!y.isKeyVisible),["prevent"]))},[(0,i.Wm)(v,{name:y.isKeyVisible?"eye-off":"eye"},null,8,["name"])])])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{required:"",label:"Metadata API Key"},{"append-label":(0,i.w5)((()=>[d])),default:(0,i.w5)((()=>[(0,i._)("div",r,[(0,i.Wm)(D,{type:y.isKeyVisible?"text":"password",name:"meta-api-key",placeholder:"ey**************","model-value":a.settings.privateData.metaApiKey,"onUpdate:modelValue":w.changeMetaApiKey,class:"w-full mr-2"},null,8,["type","model-value","onUpdate:modelValue"]),(0,i._)("button",{class:"ww-editor-button -icon -secondary -dark",onClick:t[1]||(t[1]=(0,s.iM)((e=>y.isKeyVisible=!y.isKeyVisible),["prevent"]))},[(0,i.Wm)(v,{name:y.isKeyVisible?"eye-off":"eye"},null,8,["name"])])])])),_:1}),y.deprecated?((0,i.wg)(),(0,i.iD)("p",c,[(0,i.Wm)(v,{class:"mr-1",name:"warning",small:""}),(0,i.Uk)(" Setting up your Metadata API key will reset your configuration for this step. ")])):(0,i.kq)("",!0),(0,i.Wm)(k,{type:"select",placeholder:"Select an instance","model-value":a.settings.privateData.instanceId,disabled:!a.settings.privateData.apiKey&&!a.settings.privateData.metaApiKey,options:w.instancesOptions,required:"",label:"Instance","onUpdate:modelValue":w.changeInstance},null,8,["model-value","disabled","options","onUpdate:modelValue"]),(0,i.Wm)(k,{type:"query",placeholder:"Default: "+(y.defaultDomain||""),"model-value":a.settings.publicData.customDomain,disabled:!a.settings.privateData.instanceId,label:"Instance domain","onUpdate:modelValue":w.setCustomDomain},null,8,["placeholder","model-value","disabled","onUpdate:modelValue"]),w.incorrectCustomDomain?((0,i.wg)(),(0,i.iD)("p",u,[(0,i.Wm)(v,{class:"mr-1",name:"warning",small:""}),(0,i.Uk)(" The custom domain must not include the protocol (http(s)://) ")])):(0,i.kq)("",!0),(0,i.Wm)(k,{label:"Workspace",type:"select",placeholder:"Select a workspace",required:"","model-value":a.settings.privateData.workspaceId,disabled:!a.settings.privateData.instanceId,options:w.workspacesOptions,"onUpdate:modelValue":w.changeWorkspace},null,8,["model-value","disabled","options","onUpdate:modelValue"]),(0,i.Wm)(k,{label:"Get Me Endpoint",type:"select",full:"",placeholder:"Select an endpoint",required:"","model-value":a.settings.publicData.getMeEndpoint,disabled:!a.settings.privateData.workspaceId,options:w.endpointsOptions.filter((e=>e.label.startsWith("GET"))),"onUpdate:modelValue":w.setGetMeEndpoint},null,8,["model-value","disabled","options","onUpdate:modelValue"]),(0,i.Wm)(k,{label:"Login Endpoint",type:"select",full:"",placeholder:"Select an endpoint",required:"","model-value":a.settings.publicData.loginEndpoint,disabled:!a.settings.privateData.workspaceId,options:w.endpointsOptions.filter((e=>e.label.startsWith("POST"))),"onUpdate:modelValue":w.setLoginEndpoint},null,8,["model-value","disabled","options","onUpdate:modelValue"]),(0,i.Wm)(k,{label:"Signup Endpoint",type:"select",full:"",placeholder:"Select an endpoint",required:"","model-value":a.settings.publicData.signupEndpoint,disabled:!a.settings.privateData.workspaceId,options:w.endpointsOptions.filter((e=>e.label.startsWith("POST"))),"onUpdate:modelValue":w.setSignupEndpoint},null,8,["model-value","disabled","options","onUpdate:modelValue"]),(0,i.Wm)(f,{label:"OAuth"},{"append-label":(0,i.w5)((()=>[m])),default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(v,{large:"",name:"puzzle",class:"mr-2"}),(0,i._)("span",h,(0,n.zw)(w.socialProviders||"none"),1)])])),_:1})]),(0,i.Wm)(E,{loading:y.isLoading},null,8,["loading"])],64)}let y=null;var w={props:{plugin:{type:Object,required:!0},settings:{type:Object,required:!0}},emits:["update:settings"],data(){return{deprecated:!1,isKeyVisible:!1,isLoading:!1,instances:[],workspaces:[],apiSpec:[],defaultDomain:null}},computed:{instancesOptions(){return this.instances.map((e=>({label:e.name,value:String(e.id)})))},workspacesOptions(){return this.workspaces.map((e=>({label:e.name,value:e.id,...e})))},socialProviders(){return Object.values(this.settings.publicData.socialProviders||{}).map((e=>e.name.replace("-oauth",""))).join(", ")},endpointsOptions(){return this.apiSpec.map((e=>Object.keys(e.paths).map((t=>Object.keys(e.paths[t]).map((a=>({label:`${a.toUpperCase()} ${t}`,value:this.removeBranchFromUrl(e.servers[0].url)+t}))))).flat())).flat()},incorrectCustomDomain(){return(this.settings.publicData.customDomain||"").includes("http")}},watch:{async"settings.privateData.metaApiKey"(e){this.initManager()},async"settings.privateData.workspaceId"(e){this.loadApiSpec(),e||this.$emit("update:settings",{...this.settings,publicData:{...this.settings.publicData,loginEndpoint:null,getMeEndpoint:null,signupEndpoint:null}})}},async mounted(){this.deprecated=!!this.settings.privateData.apiKey,this.initManager()},methods:{async initManager(){this.isLoading=!0,y=this.plugin.createManager(this.settings);try{await y.init(),await this.loadApiSpec(),this.sync()}catch(e){wwLib.wwNotification.open({text:"Failed to init Xano, please ensure your API key has the permission required.",color:"red"})}this.isLoading=!1},sync(){this.instances=y.getInstances(),this.workspaces=y.getWorkspaces(),this.defaultDomain=y.getBaseDomain(),this.$emit("update:settings",{...this.settings,privateData:{...this.settings.privateData,instanceId:y.getInstance()?.id,workspaceId:y.getWorkspace()?.id},publicData:{...this.settings.publicData,domain:y.getBaseDomain(),customDomain:y.getCustomDomain()||this.settings.publicData.customDomain,loginEndpoint:y.fixUrl(this.settings.publicData.loginEndpoint),getMeEndpoint:y.fixUrl(this.settings.publicData.getMeEndpoint),signupEndpoint:y.fixUrl(this.settings.publicData.signupEndpoint),socialProviders:y.getSocialProviders()}})},async changeApiKey(e){this.isLoading=!0,this.$emit("update:settings",{...this.settings,privateData:{...this.settings.privateData,apiKey:e}}),await y.changeApiKey(e),this.sync(),this.isLoading=!1},async changeMetaApiKey(e){this.$emit("update:settings",{...this.settings,privateData:{...this.settings.privateData,apiKey:null,metaApiKey:e}})},async changeInstance(e){this.isLoading=!0,await y.changeInstance(e),this.sync(),this.isLoading=!1},async changeWorkspace(e){this.isLoading=!0,await y.changeWorkspace(e),this.sync(),this.isLoading=!1},setCustomDomain(e){this.$emit("update:settings",{...this.settings,publicData:{...this.settings.publicData,customDomain:e}})},setLoginEndpoint(e){this.$emit("update:settings",{...this.settings,publicData:{...this.settings.publicData,loginEndpoint:e}})},setGetMeEndpoint(e){this.$emit("update:settings",{...this.settings,publicData:{...this.settings.publicData,getMeEndpoint:e}})},setSignupEndpoint(e){this.$emit("update:settings",{...this.settings,publicData:{...this.settings.publicData,signupEndpoint:e}})},async loadApiSpec(){this.apiSpec=[];try{this.isLoading=!0,this.apiSpec=await y.fetchFullSpec()}catch(e){wwLib.wwLog.error(e)}finally{this.isLoading=!1}},removeBranchFromUrl(e){const t=e.split(":");return(4===t.length?[t[0],t[1],t[2]]:t).join(":")}}},D=a(3744);const v=(0,D.Z)(w,[["render",b]]);var f=v}}]);